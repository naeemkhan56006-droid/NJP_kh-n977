<!DOCTYPE html>
<html>
<head>
    <title>NJP Job Portal</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; background: #f4f4f4; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .btn { background: #1a73e8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .job-item { border-bottom: 1px solid #eee; padding: 15px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 10px; border: 1px solid #eee; }
        .apply-form { display: none; background: #f9f9f9; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Post a Job</h2>
    <input type="text" id="t" placeholder="Job Title">
    <input type="text" id="c" placeholder="Company">
    <input type="text" id="l" placeholder="Location">
    <button class="btn" onclick="postJob()">Publish</button>
</div>

<div class="card">
    <h2>Open Jobs</h2>
    <div id="jobList"></div>
</div>

<div class="card">
    <h2>Admin: Applications</h2>
    <button class="btn" style="background:#28a745" onclick="loadApps()">Refresh List</button>
    <table>
        <thead><tr><th>Name</th><th>Email</th><th>Job ID</th></tr></thead>
        <tbody id="appList"></tbody>
    </table>
</div>

<script>
    async function loadJobs() {
        const r = await fetch('/api/jobs');
        const jobs = await r.json();
        const div = document.getElementById('jobList');
        div.innerHTML = '';
        jobs.forEach(j => {
            div.innerHTML += `
                <div class="job-item">
                    <strong>${j.title}</strong> at ${j.company} (${j.location})
                    <button onclick="document.getElementById('f-${j.id}').style.display='block'">Apply</button>
                    <div id="f-${j.id}" class="apply-form">
                        <input id="n-${j.id}" placeholder="Name">
                        <input id="e-${j.id}" placeholder="Email">
                        <button onclick="sendApp(${j.id})">Submit</button>
                    </div>
                </div>`;
        });
    }

    async function postJob() {
        await fetch('/api/jobs', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({title: document.getElementById('t').value, company: document.getElementById('c').value, location: document.getElementById('l').value})
        });
        loadJobs();
    }

    async function sendApp(id) {
        await fetch(`/api/jobs/${id}/apply`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({applicant_name: document.getElementById(`n-${id}`).value, applicant_email: document.getElementById(`e-${id}`).value})
        });
        alert("Applied!");
        document.getElementById(`f-${id}`).style.display='none';
    }

    async function loadApps() {
        const r = await fetch('/api/applications');
        const apps = await r.json();
        const tbody = document.getElementById('appList');
        tbody.innerHTML = '';
        apps.forEach(a => {
            tbody.innerHTML += `<tr><td>${a.applicant_name}</td><td>${a.applicant_email}</td><td>#${a.job_id}</td></tr>`;
        });
    }

    loadJobs();
</script>
</body>
</html>
